(function(){"use strict";function SideToolbar(wrapper,options){var defaults={width:260,height:300,right:10,bottom:10,speed:300,showHeight:600};this.settings=$.extend(defaults,options);this.$wrapper=$(wrapper);this.isVisible=false;this.$wrapper.css({display:"none"});this.initView();this.bindEvents()}SideToolbar.prototype={initView:function(){var btn='<a id="sideToolbar-btn" href="javascript:void(0);"></a>';var up='<a id="sideToolbar-up" href="javascript:void(0)"></a>';this.$wrapper.append(btn).append(up);this.fixPosition()},fixPosition:function(){this.$wrapper.css({width:this.settings.width,height:this.settings.height,right:this.settings.right,bottom:this.settings.bottom})},bindEvents:function(){var _this=this;$(document).scroll(function(){if($(document).scrollTop()>_this.settings.showHeight){if(_this.isVisible==false){_this.isVisible=true;_this.show()}}else{if(_this.isVisible==true){_this.isVisible=false;_this.hide()}}});$(document).trigger("scroll");$("#sideToolbar-btn").click(function(){if($(this).hasClass("disable")){$(this).removeClass("disable");_this.$wrapper.find(":first-child").css({visibility:"visible"})}else{$(this).addClass("disable");_this.$wrapper.find(":first-child").css({visibility:"hidden"})}});$("#sideToolbar-up").click(function(){$("body, html").animate({scrollTop:0},_this.settings.speed,"linear")})},show:function(){this.$wrapper.fadeIn(this.settings.speed)},hide:function(){this.$wrapper.fadeOut(this.settings.speed)}};window.SideToolbar=SideToolbar;$.fn.sideToolbar=function(options){var sideToolbar=new SideToolbar(this,options);return $(this)}})(jQuery);(function(window,$){"use strict";function SideCatalog(wrapper,options){var defaults={width:280,height:260,speed:300,cataList:null,isFromContent:true,content:"#content"};this.settings=$.extend(defaults,options);this.$wrapper=$(wrapper);this.mouseUpDown=true;this.timer=null;this.initCatalogView();this.bindEvents()}SideCatalog.prototype={initCatalogView:function(){var html='<div id="sidebar">'+'<div class="sidebar-top"></div>'+'<div class="sidebar-bottom"></div>'+"</div>"+'<div id="catalog">'+'<dl><a class="arrow" href="javascript:void(0);"></a></dl>'+"</div>"+'<div id="catalog-updown">'+'<div id="catalog-up"></div>'+'<div id="catalog-down"></div>'+"</div>";this.$wrapper.html(html);this.$wrapper.css({width:this.settings.width,height:this.settings.height});this.$wrapper.find("#sidebar").css({height:this.settings.height});this.$wrapper.find("#catalog").css({height:this.settings.height-30});this.$wrapper.find("dl").css({width:this.settings.width-60});this.initCatalogContent()},initCatalogContent:function(){var html="",cataItemClass,tagName,dotHtml;if(this.settings.isFromContent){this.$content=$(this.settings.content);var heads=this.$content.find("h2, h3");for(var i=0;i<heads.length;i++){var $head=$(heads[i]);if($head.hasClass("headline-1")){tagName="dt";cataItemClass="level1";dotHtml='<em class="dot"></em>'}else if($head.hasClass("headline-2")){tagName="dd";cataItemClass="level2";dotHtml=""}var index=$head.attr("id");var title=$head.find(".headline-title").text();html+="<"+tagName+' class="catalog-title '+cataItemClass+'">'+dotHtml+'<a href="#'+index+'" onclick="return false;">'+'<span class="title-index">'+index+'</span><span class="title-text">'+title+"</span></a></"+tagName+">"}}else{var cataList=this.settings.cataList;for(var i=0,l=cataList.length;i<l;i++){var cata=cataList[i];if(cata.level==1){tagName="dt";cataItemClass="level1";dotHtml='<em class="dot"></em>'}else{tagName="dd";cataItemClass="level2";dotHtml=""}var index=cata.index;var title=cata.title;html+="<"+tagName+' class="catalog-title '+cataItemClass+'">'+dotHtml+'<a href="#'+index+'" onclick="return false;">'+'<span class="title-index">'+index+'</span><span class="title-text">'+title+"</span></a></"+tagName+">"}}this.$wrapper.find("dl").prepend(html)},bindEvents:function(){var _this=this;this.initCatalogUpDown();$(document).scroll(function(){_this.locateCataByContent()});this.$wrapper.find("a").click(function(){var index=$(this).attr("href").replace("#","");_this.locataContentByCata(index)});this.$wrapper.find(".sideCatalog-dot").click(function(){var index=$(this).siblings("a").attr("href").replace("#","");_this.locataContentByCata(index)});$(".sidebar-top").click(function(){_this.scrollElement($("#catalog"),100,"up",1)});$(".sidebar-bottom").click(function(){_this.scrollElement($("#catalog"),100,"down",1)})},initCatalogUpDown:function(){function mouseScrollhandler(e){e.stopPropagation();e.cancelBubble=true;e.preventDefault();if(!_this.mouseUpDown)return false;_this.mouseUpDown=false;clearTimeout(_this.timer);_this.timer=setTimeout(function(){_this.mouseUpDown=true},200);var e=e||window.event;if(e.wheelDelta>=0||e.detail<0){_this.scrollElement($("#catalog"),26*4,"up",0)}else{_this.scrollElement($("#catalog"),26*4,"down",0)}}var _this=this;var $catalog=$("#catalog");var catalog=$catalog.find("dl").get(0);setTimeout(function(){var listHeight=$("#catalog").find("dl").height();if(listHeight>$("#catalog").height()){$("#sideCatalog").mouseover(function(e){_this.setUpDownClass();$("#catalog-updown").css("visibility","visible");e.stopPropagation()}).mouseout(function(e){$("#catalog-updown").css("visibility","hidden");e.stopPropagation()});$("#catalog-up").click(function(){_this.scrollElement($catalog[0],26*2,"up")});$("#catalog-down").click(function(){_this.scrollElement($catalog[0],26*2,"down")});if(document.addEventListener){document.getElementById("catalog").addEventListener("DOMMouseScroll",mouseScrollhandler,false)}document.getElementById("catalog").onmousewheel=mouseScrollhandler}else{$("#catalog-updown").remove()}},0)},setUpDownClass:function(){var $catalog=$("#catalog");var $catalogUp=this.$wrapper.find("#catalog-up");var $catalogDown=this.$wrapper.find("#catalog-down");if($catalog.height()+$catalog.scrollTop()>$catalog[0].scrollHeight-5){$catalogUp[0].className="catalog-up-enable";$catalogDown[0].className="catalog-down-disable"}else{if($catalog.scrollTop()<5){$catalogUp[0].className="catalog-up-disable";$catalogDown[0].className="catalog-down-enable"}else{$catalogUp[0].className="catalog-up-enable";$catalogDown[0].className="catalog-down-enable"}}},scrollElement:function(ele,jump,dir,dur){var _this=this;var dur=dur||300;var top="down"===dir?$(ele).scrollTop()+jump:$(ele).scrollTop()-jump;$(ele).animate({scrollTop:top},dur,"linear",function(){_this.setUpDownClass()})},locataContentByCata:function(index){var ele=this.$content.find('[id="'+index+'"]');var top=ele.offset().top;$("body, html").animate({scrollTop:top},300,"linear");window.location.hash="#"+index},locateCataByContent:function(){var cataList=this.$content.find("h2, h3");var scrollTop=$(document).scrollTop();for(var i=0,len=cataList.length;i<len;i++){var ele=cataList[i],ele1=cataList[i+1];if($(ele).offset().top-20<=scrollTop&&(i+1==len||i+1<len&&$(ele1).offset().top>scrollTop)){this.$wrapper.find(".highlight").removeClass("highlight");this.$wrapper.find('[href="#'+ele.getAttribute("id")+'"]').parent().addClass("highlight");var top=6+i*$(".catalog-title").height();top=top>$("#catalog dl").height()?$("#catalog dl").height():top;$("#catalog .arrow").stop().animate({top:top+"px"},100);ele.order=i+1;if(ele.order>5){$("#catalog").stop().animate({scrollTop:(ele.order-5)*26},100)}else{$("#catalog").stop().animate({scrollTop:0},100)}}}}};window.SideCatalog=SideCatalog;$.fn.sideCatalog=function(options){var calalog=new SideCatalog(this,options);return $(this)}})(window,jQuery);